<!DOCTYPE HTML>
<html>
    <head>
        <title>pangEvents</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="bower_components/foundation-sites/dist/foundation.min.css" />
        <link rel="stylesheet" type="text/css" href="bower_components/foundation-icon-fonts/foundation-icons.css" />
        <link rel="stylesheet" type="text/css" href="style.css" />
    </head>
    <body>
      <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
      <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
      <script type="text/javascript" src="bower_components/foundation-sites/dist/foundation.min.js"></script>
      <script type="text/javascript" src="script.js"></script>
      <header>
        <div id="menu" class="top-bar">
          <div class="top-bar-left">
            <ul class="menu" data-dropdown-menu>
              <li class="menu-text"><a href="/">PangEvents</a></li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="menu">
              <li><button type="button" onclick="javascript:window.location.href='/sign-in.html'" class="button">Sign In</button></li>
            </ul>
          </div>
        </div>
      </header>

      <div id="content" class="row">
        <div class="row">
          <div class="small-12 large-offset-4 large-4 columns">
            <div id="login-panel" class="callout">
              <h1>Login</h1>
              <div id="login-error">
              </div>
              <form id="login-form" method="post">
                <label for="username">Email Address
                  <input type="text" id="login-username" class="form-control" name="username" value="" placeholder="Username" autocomplete="username"/>
                </label>
                <label for="username">Password
                  <input type="password" id="login-password" class="form-control" name="password" value="" placeholder="Password" autocomplete="password" />
                </label>
                <input type="submit" name="submit" class="button primary" value="Submit" />
                <a href="/reset-password.html" class="button secondary">Forgot Password</a>
                <hr/>
                <h5>Signup or Login with:</h5>
                <div class="login-buttons row">
                  <div class="large-6 large-6 columns">
                    <a href="/sign-up.html" class="button button-login expanded primary">Sign Up</a>
                  </div>
                  <div class="large-6 large-6 columns">
                    <a href="#" class="button facebook button-login expanded"><i class="fi-social-facebook"></i> Facebook</a>
                    <a class="button google button-login alert expanded" href="https://accounts.google.com/o/oauth2/v2/auth?client_id=1015279124716-ittf61nieb7tb1baiflnat5l04v1nv95.apps.googleusercontent.com&redirect_uri=http://localhost:3000/&response_type=code&scope=openid%20email&login_hint=address
"><i class="fi-social-google-plus"></i> Google</a>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <script type="text/javascript">
        // Firebase Authentication
        function authHandler(error, authData) {
          if (error) {
            console.log("Login Failed!", error);
          } else {
            console.log("Authenticated successfully with payload:", authData);
          }
        }

        var ref = new Firebase("https://pang-events.firebaseio.com");
        var authData = ref.getAuth();

        // Get Authentication values
        $("#login-form").on("submit",function(event) {
          event.preventDefault();
          var username = $('#login-username').val();
          var password = $('#login-password').val();
          var data = {
            email: username,
            password: password 
          }

          ref.authWithPassword(data,function(error,authData) {
            if (navigator.onLine==false) {
              var errorMessage = '<div class="callout alert">You are not connected to the Internet.</div>'
              $("#login-error").html(errorMessage);
            } else if (error) {
              var errorMessage = '<div class="callout alert">'+ error +'</div>'
              $("#login-error").html(errorMessage);
            } else {
              var successMessage = '<div class="callout success">Authenticated successfully with payload!</div>';
              $("#login-error").html(successMessage);
              // Add save cookie here.
              var referrer = (document.referrer!=null) ? document.referrer : "/event-list.html";
              window.location.replace(referrer);
              // console.log(document.referrer);
            }
          });
        });
        
        $(".facebook.button-login").on("click",function(event) {
          event.preventDefault();
          ref.authWithOAuthPopup("facebook", authHandler);
        });
        $(".google.button-login").on("click",function(event) {
          event.preventDefault();

          var options = {
            // remember:"sessionOnly",
            scope:"openid",
            redirect_uri: "http://localhost:3000/",
            client_id: "1015279124716-ittf61nieb7tb1baiflnat5l04v1nv95.apps.googleusercontent.com",
            response_type: "profile email",
            // login_hint: "address"
          };

          ref.authWithOAuthPopup("google", function(error,authData) {
            if (error) {
              console.log("Login Failed!", error);
            } else {
              console.log("Authenticated successfully with payload:", authData);
            }
          },options);
        });

      </script>

    </body>
</html>