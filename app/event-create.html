<!DOCTYPE HTML>
<html>
    <head>
        <title>pangEvents</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="bower_components/foundation-sites/dist/foundation.min.css" />
        <link rel="stylesheet" type="text/css" href="bower_components/foundation-icon-fonts/foundation-icons.css" />
        <link rel="stylesheet" type="text/css" href="style.css" />
    </head>
    <body>
      <header>
        <div id="menu" class="top-bar">
          <div class="top-bar-left">
            <ul class="menu" data-dropdown-menu>
              <li class="menu-text"><a href="/">PangEvents</a></li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul id="loggedIn-menu" class="dropdown menu right-menu" data-dropdown-menu>
            <li class="has-submenu">
              <a href="#" class="button" id="displayedUser"></a>
              <ul class="submenu menu vertical displayedUser-dropdown" data-submenu>
                <li><a href="/user-profile.html">View Profile</a></li>
                <li><a href="javascript:logout()">Logout</a></li>
              </ul>
              </li>
            </ul>
            <ul id="loggedOut-menu" class="menu right-menu">
              <li><a href="/sign-up.html" class="button sign-up">Sign Up</a></li>
              <li><a href="/sign-in.html" class="button sign-in">Sign In</a></li>
            </ul>
          </div>
        </div>
      </header>

      <div id="content" class="row">
        <div class="large-12 columns">
          <div id="event-add" class="large-12 columns">
            <div class="row">
              <div class="small-12 large-12 columns">
                <h2>Create Event</h2>
                <hr/>
              </div>
            </div>

            <div class="row">
              <div class="small-12 large-12 columns">
                <div id="errorMessage">
                </div>
              </div>
            </div>

            <form id="event-add-form" method="post" action="">
              <div class="row">
                <div class="small-12 large-12 columns">
                  <label for="eventName">Event Name
                    <input type="text" id="eventName" name="eventName" placeholder="Event Name" required />
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="small-12 large-5 columns">
                  <label for="eventType">Event Type
                    <input type="text" list="eventTypeList" id="eventType" name="eventType" placeholder="Event Type" />
                    <!--<input type="text" id="eventType" name="eventType" placeholder="Event Type" required />-->
                  </label>
                </div>
                <datalist id="eventTypeList">
                  <option value="Conference">Conference</option>
                  <option value="Seminar">Seminar</option>
                  <option value="Meetings">Meeting</option>
                  <option value="Team Building">Team Building</option>
                  <option value="Trade Show">Trade Show</option>
                  <option value="Business Dinner">Business Dinner</option>
                  <option value="Golf Event">Golf Event</option>
                  <option value="Press Conference">Press Conference</option>
                  <option value="Networking Event">Networking Event</option>
                  <option value="Incentive Travel">Incentive Travel</option>
                  <option value="Opening Ceremony">Opening Ceremony</option>
                  <option value="Product Launch">Product Launch</option>
                  <option value="Theme Party">Theme Party</option>
                  <option value="VIP Event">VIP Events</option>
                  <option value="Trade Fair">Trade Fair</option>
                  <option value="Shareholder Meeting">Shareholder Meeting</option>
                  <option value="Award Ceremony">Award Ceremony</option>
                  <option value="Incentive Event">Incentive Event</option>
                  <option value="Board Meeting">Board Meeting</option>
                  <option value="Executive Retreat">Executive Retreat</option>
                  <option value="Wedding">Wedding</option>
                  <option value="Birthday">Birthday</option>
                  <option value="Family Event">Family Event</option>
                </datalist>
                <div class="small-12 large-4 columns end">
                  <label for="eventHost">Host
                    <input type="text" id="eventHost" name="eventHost" placeholder="Host Name" required />
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="small-12 large-6 columns">
                  <fieldset class="fieldset">
                    <h4>Event Times</h4>
                    <label for="eventStartTime">Event Start
                      <input type="datetime-local" id="eventStartTime" name="eventStartTime" placeholder="mm/dd/yy hh:mm pm" required />
                    </label>
                    <label for="eventEndTime">Event End
                      <input type="datetime-local" id="eventEndTime" name="eventEndTime" placeholder="mm/dd/yy hh:mm pm" required />
                    </label>
                  </fieldset>
                </div>

                <div class="small-12 large-6 columns">
                  <fieldset class="fieldset">
                    <h4>Event Address</h4>
                    <label for="eventAddress">Address
                      <input type="text" id="eventAddress" name="eventAddress" placeholder="Address" required />
                    </label>
                    <div class="row">
                      <div class="small-12 large-5 columns">
                        <label for="eventAddressCity">City
                          <input type="text" id="eventAddressCity" name="eventAddressCity" placeholder="City" required />
                        </label>
                      </div>
                      <div class="small-12 large-2 columns">
                        <label for="eventAddressState">State
                          <select id="eventAddressState" id="eventAddressState" name="eventAddressState" required>
                            <option value="Alabama">AL</option>
                            <option value="Alaska">AK</option>
                            <option value="Arizona">AZ</option>
                            <option value="Arkansas">AR</option>
                            <option value="California">CA</option>
                            <option value="Colorado">CO</option>
                            <option value="Connecticut">CT</option>
                            <option value="Delaware">DE</option>
                            <option value="Florida">FL</option>
                            <option value="Georgia">GA</option>
                            <option value="Hawaii">HI</option>
                            <option value="Idaho">ID</option>
                            <option value="Illinois Indiana">IL</option>
                            <option value="Iowa">IO</option>
                            <option value="Kansas">KS</option>
                            <option value="Kentucky">KY</option>
                            <option value="Louisiana">LA</option>
                            <option value="Maine">ME</option>
                            <option value="Maryland">MD</option>
                            <option value="Massachusetts">MA</option>
                            <option value="Michigan">MI</option>
                            <option value="Minnesota">MN</option>
                            <option value="Mississippi">MS</option>
                            <option value="Missouri">MO</option>
                            <option value="Montana Nebraska">MO</option>
                            <option value="Nevada">NV</option>
                            <option value="New Hampshire">NH</option>
                            <option value="New Jersey">NJ</option>
                            <option value="New Mexico">NM</option>
                            <option value="New York">NY</option>
                            <option value="North Carolina">NC</option>
                            <option value="North Dakota">ND</option>
                            <option value="Ohio">OH</option>
                            <option value="Oklahoma">OK</option>
                            <option value="Oregon">OR</option>
                            <option value="Pennsylvania Rhode Island">PA</option>
                            <option value="South Carolina">SC</option>
                            <option value="South Dakota">SD</option>
                            <option value="Tennessee">TN</option>
                            <option value="Texas">TX</option>
                            <option value="Utah">UT</option>
                            <option value="Vermont">VT</option>
                            <option value="Virginia">VA</option>
                            <option value="Washington">WA</option>
                            <option value="West Virginia">WV</option>
                            <option value="Wisconsin">WI</option>
                            <option value="Wyoming">WY</option>
                          </select>
                        </label>
                      </div>
                      <div class="small-12 large-4 column">
                        <label for="eventAddressZip">Zip Code
                          <input type="text" id="eventAddressZip" name="eventAddressZip" placeholder="Zip Code" required>
                        </label>
                      </div>
                    </div>
                  </div>
                </fieldset>
              </div>
              <input type="submit" name="submit" class="button" value="Save Event">
              <a href="/" class="button secondary">Cancel</a>
            </form>
          </div>
        </div>
        <!-- #event-category -->
      </div>
    </body>

    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-validation/dist/additional-methods.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
    <script type="text/javascript" src="bower_components/foundation-sites/dist/foundation.min.js"></script>
    <script type="text/javascript" src="/script.js"></script>
    <script type="text/javascript">
      // Set #eventType field
      $("#eventType").val(getParameterByName('eventType'));

      var ref = new Firebase("https://pang-events.firebaseio.com");
      var eventsRef = ref.child('events');

      // Submit form
      $("#event-add-form").validate({
        rules: {
          eventName: {
            required: true,
          },
          eventType: {
            required: true,
          }, 
          eventHost: {
            required: true,
          },
          eventStartTime: {
            required: true,
          },
          eventEndTime: {
            required: true,
          },
          eventAddress: {
            required: true,
          },
          eventAddressCity: {
            required: true,
          },
          eventAddressState: {
            required: true,
          },
          eventAddressZip: {
            required: true,
          }
        }, 
        messages: {
          eventName: {
            required: "Event Name is a required field.",
          },
          eventType: {
            required: "Event Type is a required field.",
          }, 
          eventHost: {
            required: "You must enter an Event Host. Is it you?",
          },
          eventStartTime: {
            required: "You need to declare when the event is going to start.",
          },
          eventEndTime: {
            required: "You need to declare when the event is going to end.",
          },
          eventAddress: {
            required: "Address is a required field.",
          },
          eventAddressCity: {
            required: "City is a required field.",
          },
          eventAddressState: {
            required: "State is a required field.",
          },
          eventAddressZip: {
            required: "Zip Code is a required field.",
          }
        },
        submitHandler: function() {
          var data = {
            eventName: $("#eventName").val(),
            eventType: $("#eventType").val(),
            eventHost: $("#eventHost").val(),
            eventStartTime: $("#eventStartTime").val(),
            eventAddress: $("#eventAddress").val(),
            eventAddressCity: $("#eventAddressCity").val(),
            eventAddressState: $("#eventAddressState").val(),
            eventAddressZip: $("#eventAddressZip").val()
          };
          // console.log(data);
          eventsRef.push().set(data,function(error) {
            if (error) {
              var message = createErrorMessage("error","Errors found! " + error);
              $("#errorMessage").html(message);
              $("#errorMessage").show();
            } else {
              var message = createErrorMessage("success","Successfully saved events.");
              $("#errorMessage").html(message);
              $("#errorMessage").show();
            }
          });
          return false;
        },
        invalidHandler: function(event, validator) {
          var errors = validator.numberOfInvalids();
          if (errors) {
            var message = errors == 1
              ? createErrorMessage("error","You missed 1 field. It has been highlighted")
              : createErrorMessage("error","You missed " + errors + " fields. They have been highlighted.");
            $("#errorMessage").html(message);
            $("#errorMessage").show();
          } else {
            $("#errorMessage").hide();
          }
        }
      });

      var isNewUser = true;

      ref.onAuth(function(authData) {
        if (authData && isNewUser) {
          // save the user's profile into the database so we can list users,
          // use them in Security and Firebase Rules, and show profiles
          var userData = {
            provider: authData.provider,
            name: getName(authData)
          };

          // Get user data
          var userDataRef = ref.child("userData").child(authData.uid);
          userDataRef.on("value",function(snapshot,prevChildKey) {
            var userInfo = snapshot.val();
            // console.log(userInfo.firstname);
            $("#displayedUser").html(userInfo.firstname);
          });

          // Show #loggedIn-menu
          $(".right-menu").hide();
          $("#loggedIn-menu").show();
          $("#displayedUser").html(userData.name);

        } else {
          // Show #loggedOut-menu
          $(".right-menu").hide();
          $("#loggedOut-menu").show();
          window.location.replace("sign-in.html");
        }
      });
    </script>
</html>