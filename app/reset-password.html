<!DOCTYPE HTML>
<html>
  <head>
      <title>pangEvents</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type="text/css" href="bower_components/foundation-sites/dist/foundation.min.css" />
      <link rel="stylesheet" type="text/css" href="bower_components/foundation-icon-fonts/foundation-icons.css" />
      <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <header>
      <div id="menu" class="top-bar">
        <div class="top-bar-left">
          <ul class="menu" data-dropdown-menu>
            <li class="menu-text"><a href="/">PangEvents</a></li>
          </ul>
        </div>
        <div class="top-bar-right">
          <ul class="menu">
            <li class="credentials"><a href="/sign-in.html" class="button sign-in">Sign In</a></li>
          </ul>
        </div>
      </div>
    </header>

    <div id="content" class="row">
      <div class="small-12 large-12 columns">
        <div class="row">
          <div class="small-12 large-12 columns">
            <h2>Reset Password</h2>
            <hr/>
          </div>
          <div class="small-12 large-offset-2 large-8 columns end">
            <div id="password-reset">
              <div id="errorMessage">
                <div class='error callout primary errorContainer'>
                  <h5><i class='fi-info'></i> Well...</h5>
                  <p>As soon as your email gets approved, we will send a new password.</p>
                </div>
              </div>
              <form id="reset-form" method="post">
                <label for="resetEmail">Email Address *
                  <input type="text" id="resetEmail" name="resetEmail" value="" minlength="3" maxlength="254" placeholder="Email Address" required />
                </label>
                <input type="submit" name="submit" class="button primary" value="Submit" />
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- #event-category -->
    </div>
  </body>
  <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
  <script type="text/javascript" src="bower_components/jquery-validation/dist/additional-methods.min.js"></script>
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
  <script type="text/javascript" src="bower_components/foundation-sites/dist/foundation.min.js"></script>
  <script type="text/javascript" src="script.js"></script>
  <script type="text/javascript">
    var ref = new Firebase("https://pang-events.firebaseio.com");

    // Prepare emailValidation
    var completeEmailRegex = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    createValidation("completeEmail",completeEmailRegex,"Passwords should have special characters such as exclamation points (!), question marks (?), hashtags (#), periods(.), commas(,), or slash(/).");

    // Cancel default submission
    $("#reset-form").submit(function(e) {
      e.preventDefault();
    });

    // Validate Signup Form
    $("#reset-form").validate({
      showErrors: function(errorMap, errorList) {
        // Show errors
        var html = "";
        if (errorList.length<=0) {
          html+= "<div class='error success errorContainer callout'>";
          html+= "<h5><i class='fi-checkbox'></i> Cool!</h5>";
          html+= "<p>No errors found. Try submitting the form.</p>"
          html+= "</div>";
         } else {
          var errors = [];
          for (var i=0;i<errorList.length;i++) {
            errors.push(errorList[i].message);
          }
          html+= "<div class='error alert errorContainer callout'>";
          html+= "<h5><i class='fi-alert'></i> Oops!</h5>";
          html+= "<p>"+ errors.join("") +"</p>";
          html+= "</div>";
        }
        $("#errorMessage").html(html);
      },
      rules: {
          resetEmail: {
            required: true,
            minlength: 3,
            maxlength: 254,
            completeEmail: true
          },
      },
      messages: {
          resetEmail: {
            required: "We will verify your identity using your email address. It is a required field.",
            minlength: "Emails have at least three characters.",
            maxlength: "Emails have at most 254 characters.",
            completeEmail: "Email address should follow proper format: email@example.com"
          },
      },
      submitHandler: function() {
        // Prepare user data to persist
        var emailAddress = $("#resetEmail").val();

        // Create user after sucessfully validating
        ref.resetPassword({
          email: emailAddress
        },function(error) {
          var html="";
          if (error) {
            switch (error.code) {
              case "INVALID_USER":
                html+="<div class='error callout alert errorContainer'>";
                html+="<h5><i class='fi-alert'></i> Oops!</h5>";
                html+="<p>The specified user account does not exist.</p>";
                html+="</div>";
                break;
              default:
                html+="<div class='error callout alert errorContainer'>";
                html+="<h5><i class='fi-alert'></i> Oops!</h5>";
                html+="<p>Error resetting password:" + error + "</p>";
                html+="</div>";
            }
          } else {
            html+="<div class='error callout success errorContainer'>";
            html+="<h5><i class='fi-alert'></i> Oops!</h5>";
            html+="<p>Password reset and email sent successfully! Check email for the password and <a href='/sign-in.html'>sign in</a>.</p>"
            html+="</div>";
          }
          $("#errorMessage").html(html);
        });

        return false;
      }
    });
  </script>
</html>